% DESY Beamer theme (fork of Arguelles v2.4.2)
% original author: Michele Piazzai — https://github.com/piazzai
% modifications: Saverio Monaco — https://github.com/SaverioMonaco/DESY-arguelles
% license: MIT (inherited from upstream)

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerthemeDESY}[2024/09/11 DESY]

\mode<presentation>

\newif\if@optSans
\@optSansfalse
\DeclareOption{sans}{\@optSanstrue}
\newif\if@optFrameno
\@optFramenofalse
\DeclareOption{frameno}{\@optFramenotrue}
\newif\if@optVert
\@optVertfalse
\DeclareOption{vert}{\@optVerttrue}
\newif\if@optSplitnav
\@optSplitnavfalse
\DeclareOption{splitnav}{\@optSplitnavtrue}
\ProcessOptions

% split navigation
\if@optSplitnav
	\useoutertheme[subsection=false]{miniframes}
	\setbeamertemplate{mini frame in other section}{}
	\RequirePackage{etoolbox}
	\let\beamer@section@set@min@width=\relax
	\patchcmd{\insertnavigation}{\hskip-1.875ex plus-1fill}{}{}{}
	\patchcmd{\sectionentry}{\hskip1.875ex plus 1fill}{}{}{}
	\patchcmd{\sectionentry}{\hyperlink{Navigation#3}{{\usebeamertemplate{section in head/foot shaded}}}}{}{}{}
	\patchcmd{\slideentry}{\usebeamertemplate{mini frame in other subsection}}{\usebeamertemplate{mini frame in other subsection of current section}}{}{}
	\patchcmd{\slideentry}{\usebeamertemplate{mini frame in other subsection}}{\usebeamertemplate{mini frame in other section}}{}{}
	\patchcmd{\slideentry}{\usebeamertemplate{mini frame in other subsection of current section}}{\usebeamertemplate{mini frame in other subsection}}{}{}
\fi

\newcommand{\Section}[1]{
	\section{#1}
	\begin{frame}[standout, plain]
		\begin{tikzpicture}[overlay, remember picture]
			\node[
				opacity=0.4,
				anchor=east,
				xshift=0cm,
				yshift=2.5cm
			] at (current page.south east)
			{\includegraphics[width=.35\paperwidth]{assets/DESY_white.pdf}};
		\end{tikzpicture}
		\begin{center}
			{\LARGE\bfseries #1}
		\end{center}
	\end{frame}
}

% package dependencies
\RequirePackage{ifluatex}
\RequirePackage{ifxetex}
% Load inputenc only for pdfLaTeX
\ifluatex
	% LuaTeX, no inputenc needed
\else
	\ifxetex
		% XeLaTeX, no inputenc needed
	\else
		% pdfLaTeX, load inputenc
		\RequirePackage[utf8]{inputenc}
	\fi
\fi
\RequirePackage[T1]{fontenc}
\RequirePackage[osf]{Alegreya}
\RequirePackage[osf]{AlegreyaSans}
\RequirePackage[euler-hat-accent]{eulervm}
\RequirePackage[bb=px]{mathalpha}
\RequirePackage[nopatch=footnote]{microtype}
\RequirePackage{fontawesome5}
\RequirePackage{opencolor}
\RequirePackage{enumitem}
\RequirePackage{parskip}
\RequirePackage{tikz}
\RequirePackage[skins]{tcolorbox}

% tikz libraries
\usetikzlibrary{calc}

% components
\useinnertheme{DESY}
\useoutertheme{DESY}
\usecolortheme{DESY}
\usefonttheme{DESY}

% sans font
\if@optSans
	\usefonttheme[onlymath]{serif}
	\newcommand\mediumfont{\AlegreyaSansMedium}
\else
	\usefonttheme{serif}
	\newcommand\mediumfont{\AlegreyaMedium}
\fi

% frame numbers
\if@optFrameno
	\defbeamertemplate*{footline}{DESY}{
		\usebeamerfont{footline section}\hfill\raisebox{.025\paperheight}{
			\insertframenumber\hspace{.01\paperwidth}
		}
	}
\fi

\AtBeginEnvironment{proof}{\let\@addpunct\@gobble}

\newcommand\End{\appendix}
\renewcommand{\appendixname}{End}

\mode<all>
\endinput
